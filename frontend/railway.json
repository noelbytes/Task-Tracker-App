{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "DOCKERFILE",
    "dockerfilePath": "Dockerfile"
  },
  "deploy": {
    "startCommand": "nginx -g 'daemon off;'",
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10
  }
}
# Render Blueprint for Task Tracker App
# This file enables one-click deployment to Render.com

services:
  # PostgreSQL Database
  - type: pserv
    name: tasktracker-db
    plan: free
    databaseName: tasktracker
    databaseUser: tasktracker

  # Spring Boot Backend
  - type: web
    name: tasktracker-backend
    runtime: docker
    plan: free
    dockerfilePath: ./backend/Dockerfile
    dockerContext: ./backend
    envVars:
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      - key: DATABASE_URL
        fromDatabase:
          name: tasktracker-db
          property: connectionString
      - key: DB_USERNAME
        fromDatabase:
          name: tasktracker-db
          property: user
      - key: DB_PASSWORD
        fromDatabase:
          name: tasktracker-db
          property: password
      - key: JWT_SECRET
        generateValue: true
      - key: JWT_EXPIRATION
        value: 86400000
      - key: CORS_ORIGINS
        value: https://tasktracker-frontend.onrender.com
    healthCheckPath: /actuator/health

  # Angular Frontend
  - type: web
    name: tasktracker-frontend
    runtime: static
    plan: free
    buildCommand: cd frontend && npm ci && npm run build
    staticPublishPath: ./frontend/dist/frontend/browser
    routes:
      - type: rewrite
        source: /*
        destination: /index.html

